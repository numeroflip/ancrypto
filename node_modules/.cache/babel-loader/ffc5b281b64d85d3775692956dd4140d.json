{"ast":null,"code":"var _jsxFileName = \"/home/aronberenyi/Code/ancrypto/src/components/contexts/DataContext.js\";\nimport React, { useState, useEffect } from 'react';\nimport cc, { coinList } from 'cryptocompare';\nimport moment from 'moment';\ncc.setApiKey('6bce00cebd36b06c07f20e0e94c2a0fe1b0211dc0a8a8dc030f6fb8b4117f707');\nconst MAX_FAVOURITES = 10;\nconst TIME_UNITS = 10;\nexport const DataContext = React.createContext();\n\nfunction getCurrFavourite(favourites) {\n  let currFavInLocal = getFromLocal('currFavourite');\n\n  if (currFavInLocal) {\n    return currFavInLocal;\n  } else if (favourites.length) {\n    return favourites[0];\n  } else return null;\n}\n\nfunction getFromLocal(item) {\n  let data = JSON.parse(localStorage.getItem('ancrypto'));\n  let answer = data ? data[item] : [];\n  return answer;\n}\n\nconst fetchPrices = async coinsArr => {\n  console.log('=====FetchPrices called');\n  let returnData = [];\n\n  try {\n    coinsArr.forEach(async coin => {\n      try {\n        let priceData = await cc.priceFull(coin, 'USD');\n        console.log('priceResponse', priceData);\n        returnData.push(priceData);\n      } catch (e) {\n        console.error('Fetch price error: ', coin, e);\n      }\n    });\n  } catch (e) {\n    console.error('Error during fetching prices :', e);\n  }\n\n  console.log('pricesArr: ', returnData);\n  return returnData;\n};\n\nconst fetchCoins = async () => {\n  try {\n    console.log('==/=FetchCoins Called');\n    let coins = await cc.coinList();\n    coins = coins.Data;\n    const filteredCoinKeys = Object.keys(coins).filter(coinKey => coins[coinKey].IsTrading);\n    let filteredObj = {};\n    filteredCoinKeys.forEach(key => filteredObj[key] = coins[key]);\n    console.log(filteredObj);\n    return filteredObj;\n  } catch (e) {\n    console.error('Error during coin fetching: ', e);\n  }\n};\n\nconst historicalPromises = (currFavourite, interval) => {\n  let promises = [];\n\n  for (let i = TIME_UNITS; i > 0; i--) {\n    const date = moment().subtract(i, interval).toDate();\n    promises.push(cc.priceHistorical(currFavourite, ['USD'], date));\n  }\n\n  return Promise.all(promises);\n};\n\nconst fetchHistorical = async (currFavourite, interval) => {\n  const results = await historicalPromises(currFavourite, interval); // Test\n\n  console.log('Promises: ', results);\n  const historical = [{\n    name: currFavourite,\n    data: results.map((ticker, index) => [moment().subtract(TIME_UNITS - index, interval).valueOf(), ticker.USD])\n  }];\n  return historical;\n};\n\nconst isDay = () => {\n  const hour = new Date().getHours();\n  return hour < 20 && hour > 7;\n}; // ===================================================================\n// DATAPROVIDER\n// ===================================================================\n\n\nexport const DataProvider = ({\n  children\n}) => {\n  // ==============STATE========================\n  const [page, setPage] = useState('dashboard');\n  const [favourites, setFavourites] = useState(getFromLocal('favourites'));\n  const [currFavourite, setCurrFavourite] = useState(getCurrFavourite());\n  const [coinList, setCoinList] = useState(null);\n  const [filteredCoins, setFilteredCoins] = useState([]);\n  const [prices, setPrices] = useState(null);\n  const [historicalData, setHistoricalData] = useState([]);\n  const [historicalInterval, setHistoricalInterval] = useState(\"months\");\n  const [theme, setTheme] = useState(isDay() ? 'light' : 'dark');\n  useEffect(() => {\n    console.log('Prices updated: ', prices);\n  }, [prices]); // Fetch Coin data at startup\n\n  useEffect(() => {\n    const init = async () => {\n      try {\n        const coins = await fetchCoins();\n        console.log('Coins in init function');\n\n        if (currFavourite.length) {\n          console.log('========fetching favourite');\n          const historical = await fetchHistorical(currFavourite, historicalInterval);\n          setHistoricalData(historical);\n        }\n\n        setCoinList(coins);\n      } catch (e) {\n        console.error('Error during startup coinList fetching: ', e);\n      }\n    };\n\n    init();\n  }, []);\n  useEffect(() => {\n    console.log('coinList updated: ', coinList);\n  }, [coinList]); // Fetch the pices of favourites\n\n  useEffect(() => {\n    const updatePrices = async coinsArr => {\n      console.log('favourites: ', favourites);\n\n      if (favourites.length) {\n        let newPrices = await fetchPrices(coinsArr);\n        setPrices(newPrices);\n      }\n\n      updatePrices(favourites);\n    };\n  }, [favourites]);\n\n  const addCoin = coinKey => {\n    if (!currFavourite) {\n      setCurrFavourite(coinKey);\n    }\n\n    if (favourites.length < MAX_FAVOURITES && !favourites.includes(coinKey)) {\n      setFavourites([...favourites, coinKey]);\n    }\n  };\n\n  useEffect(() => {\n    const updateHistoricalPrice = async () => {\n      if (currFavourite.length) {\n        try {\n          const historical = await fetchHistorical(currFavourite, historicalInterval);\n          setHistoricalData(historical);\n        } catch (e) {\n          console.error('Historical price fetching error: ', e);\n        }\n      }\n    };\n\n    setHistoricalData(null);\n    updateHistoricalPrice();\n  }, [currFavourite, historicalInterval]); // Handle localstorage updates\n\n  useEffect(() => {\n    localStorage.setItem('ancrypto', JSON.stringify({\n      favourites,\n      currFavourite\n    }));\n  }, [currFavourite, favourites]);\n\n  const removeCoin = coinKey => {\n    const updatedFavs = favourites.filter(key => key !== coinKey);\n\n    if (favourites.includes(coinKey)) {\n      console.log(true, favourites, coinKey);\n      setCurrFavourite(updatedFavs[0]);\n    }\n\n    setFavourites(updatedFavs);\n  };\n\n  const toggleTheme = () => {\n    setTheme(theme === 'light' ? 'dark' : 'light');\n  };\n\n  return /*#__PURE__*/React.createElement(DataContext.Provider, {\n    value: {\n      page,\n      theme,\n      toggleTheme,\n      coinList,\n      setPage,\n      historicalData,\n      favourites,\n      setFavourites,\n      historicalInterval,\n      setHistoricalInterval,\n      currFavourite,\n      setCurrFavourite,\n      filteredCoins,\n      setFilteredCoins,\n      addCoin,\n      removeCoin,\n      prices\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 3\n    }\n  }, children);\n};","map":{"version":3,"sources":["/home/aronberenyi/Code/ancrypto/src/components/contexts/DataContext.js"],"names":["React","useState","useEffect","cc","coinList","moment","setApiKey","MAX_FAVOURITES","TIME_UNITS","DataContext","createContext","getCurrFavourite","favourites","currFavInLocal","getFromLocal","length","item","data","JSON","parse","localStorage","getItem","answer","fetchPrices","coinsArr","console","log","returnData","forEach","coin","priceData","priceFull","push","e","error","fetchCoins","coins","Data","filteredCoinKeys","Object","keys","filter","coinKey","IsTrading","filteredObj","key","historicalPromises","currFavourite","interval","promises","i","date","subtract","toDate","priceHistorical","Promise","all","fetchHistorical","results","historical","name","map","ticker","index","valueOf","USD","isDay","hour","Date","getHours","DataProvider","children","page","setPage","setFavourites","setCurrFavourite","setCoinList","filteredCoins","setFilteredCoins","prices","setPrices","historicalData","setHistoricalData","historicalInterval","setHistoricalInterval","theme","setTheme","init","updatePrices","newPrices","addCoin","includes","updateHistoricalPrice","setItem","stringify","removeCoin","updatedFavs","toggleTheme"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport cc, { coinList } from 'cryptocompare'\nimport moment from 'moment'\n\ncc.setApiKey('6bce00cebd36b06c07f20e0e94c2a0fe1b0211dc0a8a8dc030f6fb8b4117f707')\n\nconst MAX_FAVOURITES = 10;\nconst TIME_UNITS = 10; \n\nexport const DataContext = React.createContext();\n\nfunction getCurrFavourite(favourites) {\n  let currFavInLocal = getFromLocal('currFavourite')\n  if (currFavInLocal) {return currFavInLocal}\n  else if (favourites.length) {return favourites[0]}\n  else return null\n}\n\nfunction getFromLocal (item) {\n  let data = JSON.parse(localStorage.getItem('ancrypto'))\n  let answer = data ? data[item] : [];\n  return answer\n}\n\nconst fetchPrices = async (coinsArr) => {\n  console.log('=====FetchPrices called')\n        \n  let returnData = [];\n  try {\n    coinsArr.forEach(async (coin) => {\n      try {\n          let priceData = await cc.priceFull(coin, 'USD');\n          console.log('priceResponse', priceData)\n          returnData.push(priceData)\n      } catch(e) { console.error('Fetch price error: ', coin, e) }\n    })\n  } catch(e) {console.error('Error during fetching prices :', e)}\n  console.log('pricesArr: ', returnData)\n  return returnData\n    \n}\n\nconst fetchCoins = async () => {\n  try {\n  console.log('==/=FetchCoins Called');\n  let coins = await cc.coinList()\n  coins = coins.Data\n  const filteredCoinKeys = Object.keys(coins).filter(coinKey => coins[coinKey].IsTrading)\n  let filteredObj = {}\n  filteredCoinKeys.forEach(key => filteredObj[key] = coins[key])\n  console.log(filteredObj)\n  return filteredObj\n  }\n  catch(e) {console.error('Error during coin fetching: ',e)}\n}\n\nconst historicalPromises = (currFavourite, interval) => {\n  let promises = [];\n  for (let i = TIME_UNITS; i > 0; i--) {\n    const date = moment().subtract(i, interval).toDate()\n    promises.push(\n      cc.priceHistorical(\n        currFavourite, \n        ['USD'], \n        date\n    ))\n  }\n  return Promise.all(promises)\n\n}\n\nconst fetchHistorical = async (currFavourite, interval) => {\n\n  const results = await historicalPromises(currFavourite, interval)\n  // Test\n  console.log('Promises: ',results)\n  const historical = [\n    {\n      name: currFavourite,\n      data: results.map((ticker, index) => [\n        moment().subtract(TIME_UNITS - index, interval).valueOf(),\n        ticker.USD\n      ])\n    }\n  ]\n  return historical\n}\n\n  const isDay = () => {\n    const hour = new Date().getHours();\n    return (hour < 20 && hour > 7) \n  }\n\n\n\n\n  // ===================================================================\n  // DATAPROVIDER\n  // ===================================================================\nexport const DataProvider = ({children}) => {\n\n  // ==============STATE========================\n  const [page, setPage] = useState('dashboard');\n  const [favourites, setFavourites] = useState(getFromLocal('favourites'));\n  const [currFavourite, setCurrFavourite] = useState(getCurrFavourite())\n  const [coinList, setCoinList] = useState(null)\n  const [filteredCoins, setFilteredCoins] = useState([])\n  const [prices, setPrices] = useState(null);\n  const [historicalData, setHistoricalData] = useState([])\n  const [historicalInterval, setHistoricalInterval] = useState(\"months\")\n  const [theme, setTheme] = useState(isDay() ? 'light' : 'dark' );\n\n\n  useEffect(() => {console.log('Prices updated: ', prices)}, [prices]);\n  // Fetch Coin data at startup\n  useEffect(() => {\n\n    const init = async () => {\n\n      try {\n        const coins = await fetchCoins()\n        console.log('Coins in init function');\n        if (currFavourite.length) {\n          console.log('========fetching favourite')\n          const historical = await fetchHistorical(currFavourite, historicalInterval)\n          setHistoricalData(historical)\n        }\n        setCoinList(coins)\n\n      } catch(e) {console.error('Error during startup coinList fetching: ', (e))}\n\n    }           \n\n    init()\n\n  }, [])\n\n  useEffect(() => {console.log('coinList updated: ', coinList)},[coinList])\n\n  // Fetch the pices of favourites\n  useEffect(() => {\n\n    const updatePrices = async (coinsArr) => {\n      console.log('favourites: ', favourites)\n    if (favourites.length) {\n      let newPrices = await fetchPrices(coinsArr)\n      setPrices(newPrices)\n    }\n    updatePrices(favourites)\n    }\n\n  },[favourites])\n\n  const addCoin = coinKey => {\n    if(!currFavourite) {setCurrFavourite(coinKey)}\n    if((favourites.length < MAX_FAVOURITES ) && !favourites.includes(coinKey)) {\n      setFavourites([...favourites, coinKey]);\n    }\n  }\n\n  useEffect(() => {\n    const updateHistoricalPrice = async () => {\n      if (currFavourite.length) {\n        try {\n          const historical = await fetchHistorical(currFavourite, historicalInterval)\n          setHistoricalData(historical)\n\n        } catch(e) {console.error('Historical price fetching error: ', e)}\n      }\n    }\n    setHistoricalData(null)\n    updateHistoricalPrice()\n\n  }, [currFavourite, historicalInterval])\n  // Handle localstorage updates\n  useEffect(() => {\n    localStorage.setItem('ancrypto', JSON.stringify({\n      favourites,\n      currFavourite\n    }))\n  },[currFavourite, favourites])\n\n  const removeCoin = coinKey => {\n    const updatedFavs = favourites.filter(key => key !== coinKey)\n    if( favourites.includes(coinKey) ) {console.log(true, favourites, coinKey) ; setCurrFavourite(updatedFavs[0])}\n    setFavourites(updatedFavs)\n  }\n\n  const toggleTheme = () => {\n    setTheme(theme === 'light' ? 'dark' : 'light')\n  }\n\n  return (\n  <DataContext.Provider value={\n    {\n      page, \n      theme,\n      toggleTheme,\n      coinList,\n      setPage, \n      historicalData,\n      favourites,\n      setFavourites,\n      historicalInterval,\n      setHistoricalInterval,\n      currFavourite,\n      setCurrFavourite, \n      filteredCoins,\n      setFilteredCoins,\n      addCoin, \n      removeCoin, \n      prices\n    }\n  }>{children}</DataContext.Provider>\n  )\n}"]},"metadata":{},"sourceType":"module"}