{"ast":null,"code":"import _toConsumableArray from\"/home/aronberenyi/Code/ancrypto/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/aronberenyi/Code/ancrypto/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/home/aronberenyi/Code/ancrypto/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/home/aronberenyi/Code/ancrypto/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"/home/aronberenyi/Code/ancrypto/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useState,useEffect}from'react';import cc from'cryptocompare';import moment from'moment';cc.setApiKey('6bce00cebd36b06c07f20e0e94c2a0fe1b0211dc0a8a8dc030f6fb8b4117f707');var MAX_FAVOURITES=10;var TIME_UNITS=10;export var DataContext=React.createContext();function getCurrFavourite(favourites){if(!favourites.length){return null;}if(favourites.length){return favourites[0];}var currFavInLocal=getFromLocal('currFavourite');if(currFavInLocal){return currFavInLocal;}else return null;}function getFromLocal(item){var data=JSON.parse(localStorage.getItem('ancrypto'));var answer=data?data[item]:[];return answer;}var fetchPrices=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(coinsArr){var returnData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:returnData=[];try{coinsArr.forEach(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(coin){var priceData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return cc.priceFull(coin,'USD');case 3:priceData=_context.sent;if(priceData[coin]){_context.next=6;break;}throw'The API returned an empty object';case 6:returnData.push(priceData);_context.next=13;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);// Handling if there is no data. We use this in ../Dashboard/PriceTile.js\nreturnData.push(_defineProperty({},coin,{noData:true}));console.warn('No price data for: ',coin,_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function(_x2){return _ref2.apply(this,arguments);};}());}catch(e){console.warn('Error during fetching prices :',e);}return _context2.abrupt(\"return\",returnData);case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchPrices(_x){return _ref.apply(this,arguments);};}();var fetchCoins=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var coins;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return cc.coinList();case 3:coins=_context3.sent;coins=coins.Data;return _context3.abrupt(\"return\",coins);case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.error('Error during coin fetching: ',_context3.t0);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function fetchCoins(){return _ref3.apply(this,arguments);};}();var historicalPromises=function historicalPromises(currFavourite,interval){var promises=[];for(var i=TIME_UNITS;i>0;i--){var date=moment().subtract(i,interval).toDate();promises.push(cc.priceHistorical(currFavourite,['USD'],date));}return Promise.all(promises);};var fetchHistorical=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(currFavourite,interval){var results,historical;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return historicalPromises(currFavourite,interval);case 2:results=_context4.sent;historical=[{name:currFavourite,data:results.map(function(ticker,index){return[moment().subtract(TIME_UNITS-index,interval).valueOf(),ticker.USD];})}];return _context4.abrupt(\"return\",historical);case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function fetchHistorical(_x3,_x4){return _ref4.apply(this,arguments);};}();var isNight=function isNight(){var hour=new Date().getHours();return hour>=21||hour<6;};var sortCoins=function sortCoins(cList){var sortedCoinList=[];if(cList){Object.keys(cList).forEach(function(key){var coinObj=cList[key];var order=+coinObj['SortOrder']-1;sortedCoinList[order]=coinObj['Symbol'];});}return sortedCoinList;};// ===================================================================\n// ==============================DATAPROVIDER=======================================================\n// ===================================================================\nexport var DataProvider=function DataProvider(_ref5){var children=_ref5.children;// ======================STATE========================\nvar _useState=useState(getFromLocal('favourites')),_useState2=_slicedToArray(_useState,2),favourites=_useState2[0],setFavourites=_useState2[1];var _useState3=useState(getCurrFavourite(favourites)),_useState4=_slicedToArray(_useState3,2),currFavourite=_useState4[0],setCurrFavourite=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),coinList=_useState6[0],setCoinList=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),sortedCoins=_useState8[0],setSortedCoins=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),prices=_useState10[0],setPrices=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),historicalData=_useState12[0],setHistoricalData=_useState12[1];var _useState13=useState(\"months\"),_useState14=_slicedToArray(_useState13,2),historicalInterval=_useState14[0],setHistoricalInterval=_useState14[1];var _useState15=useState(isNight()?'dark':'light'),_useState16=_slicedToArray(_useState15,2),theme=_useState16[0],setTheme=_useState16[1];// =======================EFFECTS===============================\n// --- STARTUP - init data\n// (Fetch the list of all the coins)\nuseEffect(function(){var init=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var coins;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return fetchCoins();case 3:coins=_context5.sent;// 1\nsetCoinList(coins);_context5.next=10;break;case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](0);console.error('Error during startup coinList fetching: ',_context5.t0);case 10:case\"end\":return _context5.stop();}}},_callee5,null,[[0,7]]);}));return function init(){return _ref6.apply(this,arguments);};}();init();},[]);// --- Sort coinList based on popularity\nuseEffect(function(){setSortedCoins(sortCoins(coinList));},[coinList]);//--- Fetch prices of all the favourites\nuseEffect(function(){var updatePrices=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(coinsArr){var newPrices;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!favourites.length){_context6.next=5;break;}_context6.next=3;return fetchPrices(coinsArr);case 3:newPrices=_context6.sent;setPrices(newPrices);case 5:case\"end\":return _context6.stop();}}},_callee6);}));return function updatePrices(_x5){return _ref7.apply(this,arguments);};}();updatePrices(favourites);},[favourites]);// --- Update historical prices if the selected, or the interval changes\nuseEffect(function(){var updateHistoricalPrice=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var historical;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(!currFavourite){_context7.next=11;break;}_context7.prev=1;_context7.next=4;return fetchHistorical(currFavourite,historicalInterval);case 4:historical=_context7.sent;setHistoricalData(historical);_context7.next=11;break;case 8:_context7.prev=8;_context7.t0=_context7[\"catch\"](1);console.error('Historical price fetching error: ',_context7.t0);case 11:case\"end\":return _context7.stop();}}},_callee7,null,[[1,8]]);}));return function updateHistoricalPrice(){return _ref8.apply(this,arguments);};}();setHistoricalData(null);updateHistoricalPrice();},[currFavourite,historicalInterval]);// Handle localstorage updates on change\nuseEffect(function(){localStorage.setItem('ancrypto',JSON.stringify({favourites:favourites,currFavourite:currFavourite}));},[currFavourite,favourites]);// ----------------------------ADD/REMOVE COIN-------------------------------\nvar addCoin=function addCoin(coinKey){if(!currFavourite){setCurrFavourite(coinKey);}if(favourites.length<MAX_FAVOURITES&&!favourites.includes(coinKey)){setFavourites([].concat(_toConsumableArray(favourites),[coinKey]));}};var removeCoin=function removeCoin(coinKey){var updatedFavs=favourites.filter(function(key){return key!==coinKey;});if(favourites.includes(coinKey)){setCurrFavourite(updatedFavs[0]);}setFavourites(updatedFavs);};// -----------------------------THEME TOGGLER--------------------------\nvar toggleTheme=function toggleTheme(){setTheme(theme==='light'?'dark':'light');};return/*#__PURE__*/React.createElement(DataContext.Provider,{value:{theme:theme,toggleTheme:toggleTheme,coinList:coinList,sortedCoins:sortedCoins,historicalData:historicalData,favourites:favourites,setFavourites:setFavourites,historicalInterval:historicalInterval,setHistoricalInterval:setHistoricalInterval,currFavourite:currFavourite,setCurrFavourite:setCurrFavourite,addCoin:addCoin,removeCoin:removeCoin,prices:prices}},children);};","map":{"version":3,"sources":["/home/aronberenyi/Code/ancrypto/src/components/contexts/DataContext.js"],"names":["React","useState","useEffect","cc","moment","setApiKey","MAX_FAVOURITES","TIME_UNITS","DataContext","createContext","getCurrFavourite","favourites","length","currFavInLocal","getFromLocal","item","data","JSON","parse","localStorage","getItem","answer","fetchPrices","coinsArr","returnData","forEach","coin","priceFull","priceData","push","noData","console","warn","e","fetchCoins","coinList","coins","Data","error","historicalPromises","currFavourite","interval","promises","i","date","subtract","toDate","priceHistorical","Promise","all","fetchHistorical","results","historical","name","map","ticker","index","valueOf","USD","isNight","hour","Date","getHours","sortCoins","cList","sortedCoinList","Object","keys","key","coinObj","order","DataProvider","children","setFavourites","setCurrFavourite","setCoinList","sortedCoins","setSortedCoins","prices","setPrices","historicalData","setHistoricalData","historicalInterval","setHistoricalInterval","theme","setTheme","init","updatePrices","newPrices","updateHistoricalPrice","setItem","stringify","addCoin","coinKey","includes","removeCoin","updatedFavs","filter","toggleTheme"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport cc from 'cryptocompare'\nimport moment from 'moment'\n\ncc.setApiKey('6bce00cebd36b06c07f20e0e94c2a0fe1b0211dc0a8a8dc030f6fb8b4117f707')\n\nconst MAX_FAVOURITES = 10;\nconst TIME_UNITS = 10; \n\nexport const DataContext = React.createContext();\n\nfunction getCurrFavourite(favourites) {\n  if (!favourites.length) {return null}\n  if (favourites.length) { return favourites[0]}\n  let currFavInLocal = getFromLocal('currFavourite')\n  if (currFavInLocal) {return currFavInLocal}\n  else return null\n}\n\nfunction getFromLocal (item) {\n  let data = JSON.parse(localStorage.getItem('ancrypto'))\n  let answer = data ? data[item] : [];\n  return answer\n}\n\nconst fetchPrices = async (coinsArr) => {\n        \n  let returnData = [];\n  try {\n    coinsArr.forEach(async (coin) => {\n      try {\n          let priceData = await cc.priceFull(coin, 'USD');\n          // Handle if there isn't any price data\n          if (!priceData[coin]) {throw 'The API returned an empty object'}\n          returnData.push(priceData)\n      } catch(e) { \n        // Handling if there is no data. We use this in ../Dashboard/PriceTile.js\n        returnData.push({\n          [coin]: {\n            noData: true\n          }\n        })\n        console.warn('No price data for: ', coin, e) \n      }\n    })\n  } catch(e) {console.warn('Error during fetching prices :', e)}\n  return returnData\n    \n}\n\nconst fetchCoins = async () => {\n  try {\n  let coins = await cc.coinList()\n  coins = coins.Data\n  return coins\n  }\n  catch(e) {console.error('Error during coin fetching: ',e)}\n}\n\nconst historicalPromises = (currFavourite, interval) => {\n  let promises = [];\n  for (let i = TIME_UNITS; i > 0; i--) {\n    const date = moment().subtract(i, interval).toDate()\n    promises.push(\n      cc.priceHistorical(\n        currFavourite, \n        ['USD'], \n        date\n    ))\n  }\n  return Promise.all(promises)\n\n}\n\nconst fetchHistorical = async (currFavourite, interval) => {\n\n  const results = await historicalPromises(currFavourite, interval)\n  const historical = [\n    {\n      name: currFavourite,\n      data: results.map((ticker, index) => [\n        moment().subtract(TIME_UNITS - index, interval).valueOf(),\n        ticker.USD\n      ])\n    }\n  ]\n  return historical\n}\n\n  const isNight = () => {\n    const hour = new Date().getHours();\n    return (hour >= 21 || hour < 6) \n  }\n\n  const sortCoins = (cList) => {\n\n    let sortedCoinList = []\n    if (cList) {\n      Object.keys(cList).forEach(key => {\n        let coinObj = cList[key]\n        const order = +coinObj['SortOrder'] -1\n        sortedCoinList[order] = coinObj['Symbol']\n      })\n    }\n    return sortedCoinList\n  }\n\n\n  // ===================================================================\n  // ==============================DATAPROVIDER=======================================================\n  // ===================================================================\nexport const DataProvider = ({children}) => {\n\n  // ======================STATE========================\n  const [favourites, setFavourites] = useState(getFromLocal('favourites'));\n  const [currFavourite, setCurrFavourite] = useState(getCurrFavourite(favourites))\n  const [coinList, setCoinList] = useState(null)\n  const [sortedCoins, setSortedCoins] = useState([])\n  const [prices, setPrices] = useState(null);\n  const [historicalData, setHistoricalData] = useState([])\n  const [historicalInterval, setHistoricalInterval] = useState(\"months\")\n  const [theme, setTheme] = useState(isNight() ? 'dark' : 'light' );\n\n\n  // =======================EFFECTS===============================\n\n  // --- STARTUP - init data\n  // (Fetch the list of all the coins)\n  useEffect(() => {\n\n    const init = async () => {\n      try {\n         const coins = await fetchCoins()     // 1\n        setCoinList(coins)\n      } catch(e) {console.error('Error during startup coinList fetching: ', (e))}\n    }    \n    init()\n  }, [])\n\n  // --- Sort coinList based on popularity\n  useEffect(() => {\n    setSortedCoins(sortCoins(coinList))\n  }, [coinList])\n\n  //--- Fetch prices of all the favourites\n  useEffect(() => {\n    const updatePrices = async (coinsArr) => {\n      if (favourites.length) {\n        let newPrices = await fetchPrices(coinsArr)\n        setPrices(newPrices)\n      }}\n    updatePrices(favourites)  \n  }, [favourites]);\n\n  // --- Update historical prices if the selected, or the interval changes\n  useEffect(() => {\n    const updateHistoricalPrice = async () => {\n      if (currFavourite) {\n        try {\n          const historical = await fetchHistorical(currFavourite, historicalInterval)\n          setHistoricalData(historical)\n        } catch(e) {console.error('Historical price fetching error: ', e)}\n      }}\n    setHistoricalData(null)\n    updateHistoricalPrice()\n  }, [currFavourite, historicalInterval])\n\n\n  // Handle localstorage updates on change\n  useEffect(() => {\n    localStorage.setItem('ancrypto', JSON.stringify({\n      favourites,\n      currFavourite\n    }))\n  },[currFavourite, favourites])\n\n\n  // ----------------------------ADD/REMOVE COIN-------------------------------\n  const addCoin = coinKey => {\n    if(!currFavourite) {\n      setCurrFavourite(coinKey)\n    }\n\n    if((favourites.length < MAX_FAVOURITES ) && !favourites.includes(coinKey)) {\n      setFavourites([...favourites, coinKey]);\n    }\n  }\n  const removeCoin = coinKey => {\n    const updatedFavs = favourites.filter(key => key !== coinKey)\n    if( favourites.includes(coinKey) ) {setCurrFavourite(updatedFavs[0])}\n    setFavourites(updatedFavs)\n  }\n  // -----------------------------THEME TOGGLER--------------------------\n  const toggleTheme = () => {\n    setTheme(theme === 'light' ? 'dark' : 'light')\n  }\n\n\n  return (\n  <DataContext.Provider \n    value={\n      {\n        theme,\n        toggleTheme,\n        coinList,\n        sortedCoins,\n        historicalData,\n        favourites,\n        setFavourites,\n        historicalInterval,\n        setHistoricalInterval,\n        currFavourite,\n        setCurrFavourite, \n        addCoin, \n        removeCoin, \n        prices\n      }\n    }\n  >\n    {children}\n  </DataContext.Provider>\n  )\n}"]},"metadata":{},"sourceType":"module"}