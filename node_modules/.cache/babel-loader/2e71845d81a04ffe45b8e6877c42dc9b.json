{"ast":null,"code":"var _jsxFileName = \"/home/aronberenyi/Code/ancrypto/src/components/contexts/DataContext.js\";\nimport React, { useState, useEffect } from 'react';\nimport cc from 'cryptocompare';\ncc.setApiKey('6bce00cebd36b06c07f20e0e94c2a0fe1b0211dc0a8a8dc030f6fb8b4117f707');\nconst MAX_FAVOURITES = 10;\nexport const DataContext = React.createContext();\n\nfunction getCurrFavourite(favourites) {\n  let currFavInLocal = getFromLocal('currFavourite');\n\n  if (currFavInLocal) {\n    return currFavInLocal;\n  } else if (favourites) {\n    return favourites[0];\n  } else return [];\n}\n\nexport const DataProvider = ({\n  children\n}) => {\n  // ==============STATE========================\n  const [page, setPage] = useState('dashboard');\n  const [firstVisit, setFirstVisit] = useState(localStorage.getItem('ancrypto') ? false : true);\n  const [favourites, setFavourites] = useState(firstVisit ? [] : getFromLocal('favourites'));\n  const [currFavourite, setCurrFavourite] = useState(getCurrFavourite());\n  const [coinList, setCoinList] = useState(null);\n  const [filteredCoins, setFilteredCoins] = useState([]);\n  const [prices, setPrices] = useState(null);\n  useEffect(() => {\n    setCurrFavourite(getCurrFavourite(favourites));\n  }, []);\n\n  function getFromLocal(item) {\n    let data = JSON.parse(localStorage.getItem('ancrypto'));\n    let answer = data ? data[item] : [];\n    return answer;\n  }\n\n  const updateFavsInLocalStorage = (favourites, currFavourite) => {\n    if (!favourites.length) {\n      setCurrFavourite([]);\n    }\n\n    localStorage.setItem('ancrypto', JSON.stringify({\n      favourites,\n      currFavourite\n    }));\n  }; // Write favourites into localstorage\n\n\n  useEffect(() => {\n    updateFavsInLocalStorage(favourites, currFavourite);\n  }, [favourites]); // useEffect(() => {\n  //   if ((!favourites.includes(currFavourite)) && (favourites.length > 0)) {\n  //     setCurrFavourite(favourites[0])}\n  // },[favourites])\n  // Fetch Coin data at startup\n\n  useEffect(() => {\n    const fetchCoins = async () => {\n      let coins = await cc.coinList();\n      coins = coins.Data;\n\n      try {\n        return coins;\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    const updateStateWithCoins = async () => {\n      const coins = await fetchCoins();\n      setCoinList(coins);\n    };\n\n    updateStateWithCoins();\n  }, []); // Fetch the pices of favourites\n\n  useEffect(() => {\n    const fetchPrices = async coinsArr => {\n      const returnData = [];\n      coinsArr.forEach(async coin => {\n        try {\n          let priceData = await cc.priceFull(coin, 'USD');\n          returnData.push(priceData);\n        } catch (e) {\n          console.error('Fetch price error: ', e);\n        }\n      });\n      return returnData;\n    };\n\n    const updatePrices = async coinsArr => {\n      let newPrices = await fetchPrices(coinsArr);\n      setPrices(newPrices);\n    };\n\n    updatePrices(favourites);\n  }, [favourites]);\n\n  const addCoin = coinKey => {\n    if (favourites.length < MAX_FAVOURITES && !favourites.includes(coinKey)) {\n      setFavourites([...favourites, coinKey]);\n    }\n  };\n\n  const setCurrFavouriteLocalToo = key => {\n    JSON.parse(localStorage.setItem('ancrypto', {\n      favourites: favourites,\n      currFavourite: currFavourite\n    }));\n  };\n\n  const removeCoin = coinKey => {\n    if (currFavourite === coinKey) {\n      setCurrFavouriteLocalToo[favourites[0]];\n    }\n\n    setFavourites(favourites.filter(key => key !== coinKey));\n  };\n\n  return /*#__PURE__*/React.createElement(DataContext.Provider, {\n    value: {\n      page,\n      coinList,\n      setPage,\n      favourites,\n      setFavourites,\n      currFavourite,\n      setCurrFavouriteLocalToo,\n      filteredCoins,\n      setFilteredCoins,\n      addCoin,\n      removeCoin,\n      firstVisit,\n      prices\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 3\n    }\n  }, children);\n};","map":{"version":3,"sources":["/home/aronberenyi/Code/ancrypto/src/components/contexts/DataContext.js"],"names":["React","useState","useEffect","cc","setApiKey","MAX_FAVOURITES","DataContext","createContext","getCurrFavourite","favourites","currFavInLocal","getFromLocal","DataProvider","children","page","setPage","firstVisit","setFirstVisit","localStorage","getItem","setFavourites","currFavourite","setCurrFavourite","coinList","setCoinList","filteredCoins","setFilteredCoins","prices","setPrices","item","data","JSON","parse","answer","updateFavsInLocalStorage","length","setItem","stringify","fetchCoins","coins","Data","e","console","log","updateStateWithCoins","fetchPrices","coinsArr","returnData","forEach","coin","priceData","priceFull","push","error","updatePrices","newPrices","addCoin","coinKey","includes","setCurrFavouriteLocalToo","key","removeCoin","filter"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport cc from 'cryptocompare'\n\n\ncc.setApiKey('6bce00cebd36b06c07f20e0e94c2a0fe1b0211dc0a8a8dc030f6fb8b4117f707')\n\nconst MAX_FAVOURITES = 10;\n\nexport const DataContext = React.createContext();\n\nfunction getCurrFavourite(favourites) {\n  let currFavInLocal = getFromLocal('currFavourite')\n  if (currFavInLocal) {return currFavInLocal}\n  else if (favourites) {return favourites[0]}\n  else return []\n}\n\nexport const DataProvider = ({children}) => {\n\n  // ==============STATE========================\n  const [page, setPage] = useState('dashboard');\n  const [firstVisit, setFirstVisit] = useState(localStorage.getItem('ancrypto') ? false : true)\n  const [favourites, setFavourites] = useState(firstVisit ? [] : getFromLocal('favourites'));\n  const [currFavourite, setCurrFavourite] = useState(getCurrFavourite())\n  const [coinList, setCoinList] = useState(null)\n  const [filteredCoins, setFilteredCoins] = useState([])\n  const [prices, setPrices] = useState(null);\n\n\n\n  useEffect(() => {\n    setCurrFavourite(getCurrFavourite(favourites))\n  },[])\n\n  function getFromLocal (item) {\n    let data = JSON.parse(localStorage.getItem('ancrypto'))\n    let answer = data ? data[item] : [];\n    return answer\n  }\n\n\n  const updateFavsInLocalStorage = (favourites, currFavourite) => {\n \n    if (!favourites.length) {setCurrFavourite([])}\n    localStorage.setItem('ancrypto', JSON.stringify({favourites, currFavourite}))\n  }\n\n  // Write favourites into localstorage\n  useEffect(() => {\n    updateFavsInLocalStorage(favourites, currFavourite)\n  }, [favourites])\n\n  // useEffect(() => {\n  //   if ((!favourites.includes(currFavourite)) && (favourites.length > 0)) {\n  //     setCurrFavourite(favourites[0])}\n  // },[favourites])\n\n  // Fetch Coin data at startup\n  useEffect(() => {\n    const fetchCoins = async () => {\n      let coins = await cc.coinList()\n      coins = coins.Data\n      try {return coins}\n      catch(e) {console.log(e)}\n  }\n    const updateStateWithCoins = async () => {\n      const coins = await fetchCoins()\n      setCoinList(coins)\n    }           \n\n    updateStateWithCoins()\n\n  }, [])\n\n  // Fetch the pices of favourites\n  useEffect(() => {\n    const fetchPrices = async (coinsArr) => {\n        \n      const returnData = [];\n      coinsArr.forEach(async (coin) => {\n        try {\n            let priceData = await cc.priceFull(coin, 'USD');\n            returnData.push(priceData)\n        } catch(e) { console.error('Fetch price error: ', e) }\n      })\n      return returnData\n        \n    }\n    const updatePrices = async (coinsArr) => {\n      let newPrices = await fetchPrices(coinsArr)\n      setPrices(newPrices)\n    }\n    updatePrices(favourites) \n  },[favourites])\n\n  const addCoin = coinKey => {\n    if((favourites.length < MAX_FAVOURITES ) && !favourites.includes(coinKey)) {\n      setFavourites([...favourites, coinKey]);\n    }\n  }\n\n\n  const setCurrFavouriteLocalToo = key => {\n    JSON.parse(localStorage.setItem('ancrypto', {\n      favourites: favourites,\n      currFavourite: currFavourite\n    }))\n  }\n  const removeCoin = coinKey => {\n      if(currFavourite === coinKey) {setCurrFavouriteLocalToo[favourites[0]]}\n      setFavourites(favourites.filter(key => key !== coinKey))\n  }\n\n\n\n  return (\n  <DataContext.Provider value={\n    {\n      page, \n      coinList,\n      setPage, \n      favourites,\n      setFavourites,\n      currFavourite,\n      setCurrFavouriteLocalToo, \n      filteredCoins,\n      setFilteredCoins,\n      addCoin, \n      removeCoin, \n      firstVisit,\n      prices\n    }\n  }>{children}</DataContext.Provider>\n  )\n}"]},"metadata":{},"sourceType":"module"}